---
title: '[SQLD 자격증 공부] Chaper5 - 관리구문(WEEK 7)'
date: '2025-10-19'
tags: ['sqld', 'database', 'license']
draft: false
summary: SQLD 7주차 공부 내용을 정리.
---

import ImageWithCaption from '@/components/mdxComponents/ImageWithCaption'
import InternalLink from '@/components/mdxComponents/InternalLink'

### 1. DML(Data Manipulation Language)

    - 데이터 조작언어, 즉 데이터를 조작하는 작업을 수행허는 SQL 명령어이다.
    - 이미 만들어져있는 테이블에 레코드를 추가하고, 변경하며, 삭제하는 등 테이블의 데이터를 변경하는 작업.
    - INSERT, UPDATE, DELETE, MERGE문 등이 있다.
    - DDL과 달리 자동커밋이 되지 않음. 명시적으로 커밋을 실행하기 전까지는 되돌릴수 있다.

    1. **INSERT**
      - 테이블에 레코드를 추가하는 명령어
      - 기본문법
        - ```sql
            INSERT INTO 테이블명 (컬럼1, 컬럼2, 컬럼3)
            VALUES (값1, 값2, 값3);
            ```
        - 칼럼1에 값1 값이 1대1로 매칭되어 테이블에 레코드가 생성된다.
        - 입력되지 않는 칼럼은 null값이 입력되고, not null인 경우 오류가 발생한다.
        - auto generate가 설정된 칼럼은 따로 건들지 않아도 알아서 값을 입력한다.
      - 모든 칼럼 값을 입력할때
        - ```sql
            INSERT INTO 테이블명
            VALUES (값1, 값2, 값3);
            ```
        - 입력되는 values가 모든 행을 충족할때 따로 칼럼명을 적지 않아도 된다.(보수적으로 하고싶을때는 적는걸 추천!)
      - 여러행 한번에 추가
        - ```sql
            INSERT INTO test (id, name, age)
            VALUES
                (3, 'Minho', 25),
                (4, 'Yuna', 29),
                (5, 'Hana', 33);
            ```
        - 입력되는 values가 모든 행을 충족할때 따로 칼럼명을 적지 않아도 된다.
    2. **UPDATE**
      - 기존의 레코드를 수정하는 명령어.
      - WHERE절을 통해 수정하고가 하는 레코드를 특정하여 지정해야함.
      - 기본문법
        - ```sql
            UPDATE 테이블명
            SET 컬럼1 = 값1, 컬럼2 = 값2
            WHERE 조건;
            ```
        - 조건을 지정하지 않으면 모든 행이 수정되므로 주의해야 한다.
        - SET 뒤에는 콤마(,)로 구분하여 여러 컬럼을 동시에 수정할 수 있다.
      - 예시
        - ```sql
            UPDATE student
            SET age = 26, major = 'Computer Science'
            WHERE id = 3;
            ```
        - id가 3인 학생의 나이와 전공을 변경한다.
      - 전체 데이터 수정 (조건 미지정)
        - ```sql
            UPDATE student
            SET grade = 'A';
            ```
        - 모든 학생의 grade 컬럼을 'A'로 변경한다. (⚠️실무에서는 거의 사용하지 않는다.)
    3. **DELETE**
      - 기존의 레코드를 삭제하는 명령어.
      - 특정 레코드를 명시하지 않으면 모든 레코드가 삭제된다.
      - 기본문법
        - ```sql
            DELETE FROM 테이블명
            WHERE 조건;
            ```
        - WHERE 절을 생략하면 모든 행이 삭제되므로 주의가 필요하다.
      - 예시
        - ```sql
            DELETE FROM student
            WHERE id = 4;

            ```
        - id가 4인 학생의 정보를 삭제한다.
      - 모든 행 삭제
        - ```sql
            DELETE FROM student;
            ```
        - 전체 데이터가 삭제되지만, 테이블 구조는 유지된다.
        - TRUNCATE TABLE student;는 DELETE와 달리 더 빠르게 전체 삭제하지만 ROLLBACK 불가능하다.
    4. **MERGE**
      - 두 테이블 간 데이터를 비교하여 조건에 따라 INSERT / UPDATE / DELETE를 한 번에 수행하는 명령어
      - 주로 데이터 동기화 또는 업서트(Upsert) 기능을 구현할 때 사용된다.
      - 기본문법
        - ```sql
            MERGE INTO 타겟테이블 AS T -- T: 데이터를 "받는" 테이블 (즉, 수정/추가 대상)
            USING 소스테이블 AS S -- S: 데이터를 "참조하는" 테이블 (즉, 기준 데이터 제공)
            ON (T.기준컬럼 = S.기준컬럼) -- 두 테이블을 비교할 조건 (JOIN 조건처럼 동작)
            WHEN MATCHED THEN -- 조건이 맞을때
                UPDATE SET T.컬럼1 = S.컬럼1, T.컬럼2 = S.컬럼2 -- 기존 데이터를 수정(UPDATE)
            WHEN NOT MATCHED THEN -- 조건이 안맞을때
                INSERT (컬럼1, 컬럼2, 컬럼3)
                VALUES (S.컬럼1, S.컬럼2, S.컬럼3); -- 새로운 데이터를 추가(INSERT)
            ```
            - WHEN MATCHED : 두 테이블의 기준 컬럼이 일치할 때(=존재할 때) → UPDATE 수행
            - WHEN NOT MATCHED : 존재하지 않을 때 → INSERT 수행
      - 예시
          - ```sql
              MERGE INTO student AS T
              USING new_student AS S
              ON (T.id = S.id)
              WHEN MATCHED THEN
                  UPDATE SET T.name = S.name, T.age = S.age
              WHEN NOT MATCHED THEN
                  INSERT (id, name, age)
                  VALUES (S.id, S.name, S.age);

              ```
          - student 테이블에 new_student 데이터를 비교하여,
              - id가 이미 존재하면 UPDATE
              - 존재하지 않으면 INSERT

### 2. TCL(Transaction Control Language)

    - <InternalLink link="트랜잭션transaction" name="트랜잭션" file="sqld"/> 제어언어, 트랜잭션을 제어하는 SQL명령어이다.
    - 트랜잭션은 INSERT, UPDATE, DELETE와 같은 명령들이 하나의 트랜잭션으로 묶어서 처리하거나 명령들의 수행 작업을 취소할 수 잇는 명령어를 제공

    1. **트랜잭션의 특징**
        - 원자성 : 하나의 트랜잭션은 모두 실행하거나 모두 실행하지 않거나 둘중 하나만의 결과만 낸다.
          - 일부만 반영되는 일은 없다. 실패 시 전체가 롤백되어 이전 상태로 복구된다.
        - 일관성 : 트랜잭션이후와 이전 모두 정합성을 갖고 이전에 오류가 없다면 이후에도 오류가 없다.
          - 데이터의 제약조건이나 규칙이 항상 유지되어야 한다. (예: 계좌 잔액이 음수가 되지 않음)
        - 고립성 : 트랜잭션관의 영향은 없다.
          - 동시에 실행되더라도 서로 간섭하지 않고 독립적으로 처리된다.
        - 영속성 : 트랜잭션 결과값이 영구적으로 DB에 저장된다.
          - 커밋 후에는 전원 꺼짐이나 장애가 발생해도 데이터가 보존된다.

    2. **COMMIT**
        - COMMIT은 INSERT, UPDATE, DELETE와 같은 DML명령들을 통한 변경사항을 데이터베이스에 반영 적용한다.

    3. **ROLLBACK**
        - 트랜잭션에 포함된 변경사항을을 저장된 시점(SAVEPOINT)이전으로 되돌린다.
        - 이미 커밋이 된 사항에 대해서는 롤백이 불가능하다.
        - CREATE, ALTER, TRUNCATE와 같은 DDL은 자동 커밋이라 롤백 불가.

    4. **SAVEPOINT**
        - 롤백을 하기 위한 저장점을 지정

### 3. DDL(Data Definition Language)

    - 데이터 정의 언어로, 스키마를 정의하고 이를 관리하는 SQL명령어이다.
    - ERD(Entity Relationship Diagram)와 일치하며, ERD와 같이 논리적으로 설계된 데이터베이스를 DBMS에 실제로 저장하는 역할을 한다.
    - DDL을 통해 지정해야하는 요소
        - | 요소       | 설명                       |
          |----------|--------------------------|
          | 테이블 이름 | 테이블의 이름을 지정    |
          | 칼럼 이름 | 칼럼명을 지정    |
          | 칼럼 데이터 타입    | 칼럼의 데이터 타입을 지정          |
          | 칼럼 데이터 크기  | 칼럼의 데이터 크기를 지정 |
          | 제약조건  | PK, NOT NULL과 같은 칼럼의 제약조건을 지정 |


    1. **CREATE**
        - 테이블 생성 명령어
        - 데이터베이스 객체 생성 (TABLE, VIEW, INDEX 등)
        - 예시
          - ```sql
              CREATE TABLE 테이블명 (
                  컬럼명1 데이터타입1 [DEFAULT 기본값1] [NULL | NOT NULL],
                  컬럼명2 데이터타입2 [DEFAULT 기본값2] [NULL | NOT NULL],
                  CONSTRAINT 제약조건명 PRIMARY KEY(컬럼명1),
                  CONSTRAINT 제약조건명 FOREIGN KEY(컬럼명2) REFERENCES 다른테이블(컬럼명)
              );
                ```
        - 제약조건 종류
          1. PRIMARY KEY: 기본키, 중복 불가 + NULL 불가
          2. FOREIGN KEY: 외래키, 다른 테이블의 기본키 참조
          3. UNIQUE: 중복 불가 (NULL 허용 가능)
          4. NOT NULL: NULL 입력 불가
          5. CHECK: 조건식 만족해야 입력됨
    
    2. **ALTER**
        - 이미 생성된 테이블의 컬럼, 제약조건, 이름 등을 수정할 때 사용
        - 예시
          - ```sql
              -- 칼럼추가
              ALTER TABLE 테이블명 ADD 컬럼명 데이터타입;
              ```
          - ```sql
              -- 칼럼삭제
              ALTER TABLE 테이블명 DROP COLUMN 컬럼명;
              ```
          - ```sql
              -- 칼럼변경
              ALTER TABLE 테이블명 MODIFY 컬럼명 데이터타입 [DEFAULT 값] [NULL | NOT NULL];
              ```
          - ```sql
              -- 칼럼이름변경
              ALTER TABLE 테이블명 RENAME COLUMN 기존명 TO 새이름;
              ```
          - ```sql
              -- 제약조건 추가
              ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건명 제약조건(컬럼명);
              ```
    3. **DROP**
        - 테이블 전체 삭제
        - CASCADE CONSTRAINTS 옵션: 다른 테이블이 참조 중일 때 제약조건까지 함께 삭제
        - 예시
          - ```sql
              DROP TABLE 테이블명 [CASCADE CONSTRAINTS];
              ```
    4. **TRUNCATE**
        - 데이터만 삭제하고 구조(스키마)는 유지
        - DELETE와 달리 롤백 불가, 저장공간이 해제됨(Release)
        - 예시
          - ```sql
              TRUNCATE TABLE 테이블명;
              ```


### 4. DCL(Data Control Language)

    - 데이터 제어 언어로, 데이터베이스 사용자 생성/권한 부여/회수 등을 수행하는 명령어이다.
    - 주요 명령어: CREATE USER, ALTER USER, DROP USER, GRANT, REVOKE, CREATE ROLE
    1. **USER 관련 명령어**
        - USER 관련 명령어는 계정을 생성하고 변경하며, 삭제하는 명령어
        - 예시1 (사용자 생성)
            - ```sql
                --사용자 생성
                CREATE USER 사용자명 IDENTIFIED BY 비밀번호;
                ```
            - 새로운 사용자를 생성한다.
            - 동일한 이름의 사용자가 이미 존재하면 오류 발생
            - 이미 있는 사용자는 ALTER USER로 변경
        
        - 예시2 (사용자 비밀번호 변경)
            - ```sql
                --사용자 비밀번호 변경
                ALTER USER 사용자명 IDENTIFIED BY 새비밀번호;
                ```
            - 새로운 사용자를 생성한다.
            - 동일한 이름의 사용자가 이미 존재하면 오류 발생
            - 이미 있는 사용자는 ALTER USER로 변경
        
        - 예시3 (사용자 삭제)
            - ```sql
                --사용자 삭제
                DROP USER 사용자명;
                ```
            - 지정된 사용자를 삭제한다.

    2. **권한(Privilege) 관련 명령어**
        - 데이터 베이스의 접근 권한을 부여한다.
        - 생성한 계정에 특정 데이터베이스에 대한 읽기 및 쓰기 권한을 부여하는 명령어
        - 예시1 (권한부여)
            - ```sql
                --권한 부여
                GRANT 권한 [ON 테이블명] TO 사용자 [WITH GRANT OPTION];
                ```
            - 특정 사용자에게 데이터베이스 접근 권한 부여
            - WITH GRANT OPTION: 부여받은 사용자가 다른 사용자에게도 권한을 부여 가능
        
        - 예시2 (권한 회수)
            - ```sql
                --권한 회수
                REVOKE 권한 [ON 테이블명] FROM 사용자 [RESTRICT | CASCADE];
                ```
            - 특정 사용자에게 부여된 권한을 회수
            - RESTRICT: 해당 권한을 다른 사용자가 이용 중이면 회수 불가
            - CASCADE: 관련된 모든 권한을 연쇄적으로 회수
        
    3. **ROLE 관련 명령어**
        - ROLE: 여러 권한을 묶어서 하나의 단위로 관리하는 권한 집합
        - 단계별 ROLE 부여
          - 단계1 (ROLE 생성)
              - ```sql
                  --롤생성
                  CREATE ROLE 역할명;
                  ```
          - 단계2 (ROLE에 권한 부여)
              - ```sql
                  --권한부여
                  GRANT CREATE 권한1, 권한2 TO 역할명;
                  ```
          - 단계3 (사용자에게 ROLE 부여)
              - ```sql
                  --권한부여
                  GRANT 역할명 TO 사용자명;
                  ```
        - 예시
          - ```sql
              --권한부여
              CREATE ROLE ROLE_MGR;
              GRANT CREATE SESSION, CREATE TABLE, CREATE USER TO ROLE_MGR;
              GRANT ROLE_MGR TO USER1;
              ```
          - USER1은 DB 접속, 테이블 생성, 사용자 생성이 가능한 관리자급 권한을 갖게 된다.